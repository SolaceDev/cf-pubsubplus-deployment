name: solace_pubsub
releases:
- name: docker
  version: latest
- name: solace-pubsub
  version: latest
- name: on-demand-service-broker
  version: latest
- name: solace-pubsub-broker
  version: latest
- name: cf-mysql
  version: 36.14.0
- name: solace-service-adapter
  version: latest
update:
  canaries: 1
  canary_watch_time: 30000-240000
  max_in_flight: 1
  update_watch_time: 30000-600000
  serial: true
stemcells:
- alias: default
  os: ((bosh_stemcell))
  version: ((bosh_stemcell_version))
instance_groups:
- name: deploy-all
  jobs:
  - name: deploy-all
    release: solace-pubsub-broker
    provides: {}
    consumes:
      solace_pubsub_shared: { from: shared_list }
      solace_pubsub_large: { from: large_list }
      solace_pubsub_medium_ha: { from: medium_ha_list }
      solace_pubsub_large_ha: { from: large_ha_list }
      solace_pubsub_standard_medium: { from: standard_medium_list }
      solace_pubsub_standard_medium_ha: { from: standard_medium_ha_list }
      mysql: { from: mysql-proxy }
      credhub: { from: credhub, deployment: ((cf_deployment)) }
  instances: 1
  vm_type: minimal
  stemcell: default
  lifecycle: errand
  azs:
  - z1
  networks:
  - name: default
  properties:
    apply_open_security_group: true
    app_domains:
    - ((app_domain))
    application_access_auth_scheme:
      value: vmr_internal
    cf:
      admin_password: ((cf_admin_password))
      admin_user: admin
    uaa:
      admin_client: admin
      admin_client_secret: ((uaa_admin_client_secret))
    domain: ((system_domain))
    ldap_config:
      value: disabled
    management_access_auth_scheme:
      value: vmr_internal
    org: ((solace_broker_cf_organization))
    security:
      password: ((service_broker_password))
      user: ((service_broker_user))
    mysql_config:
      value: internal
      internal: 
        user: service_broker
        password: ((cf_mysql_mysql_seeded_databases_service_broker_password))
    secure_service_credentials: ((secure_service_credentials))
    default_orphaned_resource_policy: Abort
    service_catalog:
      id: 9b629341-3e08-47f1-bd56-aa05e78a47f3
      service_name: solace-pubsub
      service_description: Solace PubSub+ Message Broker for real-time, multi-protocol data distribution
      bindable: true
      plan_updatable: true
      metadata:
        displayName: Solace PubSub+
        imageUrl: http://solace.com/wp-content/uploads/2018/05/Solace_Logo_Green_360x100-1.png
        providerDisplayName: Solace Corporation
        longDescription: Solace PubSub+ Message Broker for real-time, multi-protocol data distribution
        documentationUrl: http://docs.pivotal.io/partners/solace-pubsub/
        supportUrl: http://dev.solace.com
      tags:
        - solace
        - pubsub 
        - solace-pubsub
        - rest
        - mqtt
        - mq
        - queue
        - event-streaming
        - amqp
        - jms
        - messaging
        - publish-subscribe
        - message-queuing
        - request-reply
      global_properties:
        allocate_ahead: true
        persistence: true
      plans:
      - planName: standard-medium
        poolName: standard-medium
        id: e5b905d0-965a-11e8-9eb6-529269fb1459
        description: A single Message VPN in a medium Standard Solace Message Router
        pointFormDescription:
          - None
        isHA: false
        evaluationLimits: &standard_medium_limits
          maxVpns: 1
          credentialsPerVpn: 500
          maxConnections: 1000
          maxRestConnections: 1000
          maxSubscriptions: 500000
          maxTransactedSessions: 1000
          maxTransactions: 5000
          maxEndpoints: 1000
      - planName: standard-medium-ha
        poolName: standard-medium-ha
        id: 2286ba52-965b-11e8-9eb6-529269fb1459
        description: A single Message VPN in a medium HA Standard Solace Message Router
        pointFormDescription:
          - None
        isHA: true
        evaluationLimits: &standard_medium_ha_limits
          maxVpns: 1
          credentialsPerVpn: 500
          maxConnections: 1000
          maxRestConnections: 1000
          maxSubscriptions: 500000
          maxTransactedSessions: 1000
          maxTransactions: 5000
          maxEndpoints: 1000
      - planName: enterprise-shared
        poolName: enterprise-shared
        id: 68bc18fa-3b06-41a1-bd66-bc6ff2281b75
        description: A single Message VPN in a shared Solace Message Router useful for light traffic and development
        pointFormDescription:
          - A Message VPN on a shared Solace Message Router
          - Up to 100 Service Instance Bindings
          - Up to 200 durable Endpoints
          - Maximum of 4 GB Message Spool
          - Maximum of 100K subscriptions
          - One Message VPN Scoped Admin account
        isHA: false
        evaluationLimits:
          maxVpns: 5
          credentialsPerVpn: 100
          maxConnections: 200
          maxRestConnections: 200
          maxSubscriptions: 100000
          maxTransactions: 1000
          maxTransactedSessions: 200
          maxEndpoints: 200
        enterpriseLimits:
          maxVpns: 5
          credentialsPerVpn: 190
          maxConnections: 200
          maxRestConnections: 200
          maxSubscriptions: 100000
          maxTransactions: 1000
          maxTransactedSessions: 200
          maxEndpoints: 200
      - planName: enterprise-large
        poolName: enterprise-large
        id: 52dcd959-ee94-4bd8-b94f-630ddefd879e
        description: A single message VPN on a dedicated Solace Message Router
        pointFormDescription:
          - A Message VPN on a dedicated Solace Message Router
          - Up to 500 Service Instance Bindings
          - Up to 1000 durable Endpoints
          - Maximum of 20 GB Message Spool
          - Maximum of 500K subscriptions
          - One Message VPN Scoped Admin account
        isHA: false
        evaluationLimits:
          maxVpns: 1
          credentialsPerVpn: 500
          maxConnections: 1000
          maxRestConnections: 1000
          maxSubscriptions: 500000
          maxTransactions: 5000
          maxTransactedSessions: 1000
          maxEndpoints: 1000
        enterpriseLimits:
          maxVpns: 1
          credentialsPerVpn: 9990
          maxConnections: 10000
          maxRestConnections: 6000
          maxSubscriptions: 500000
          maxTransactions: 50000
          maxTransactedSessions: 10000
          maxEndpoints: 10000
      - planName: enterprise-medium-ha
        poolName: enterprise-medium-ha
        id: b3a25384-eedb-4b4c-af00-610ee4dce76c
        description: A single Message VPN hosted on a Medium Solace PubSub+ Message Broker. Consumes 3 Medium-HA Solace PubSub+ Message Brokers to create an HA service instance.
        pointFormDescription:
          - A Message VPN on a Medium Solace Message Router in an HA Cluster
          - Up to 500 Service Instance Bindings
          - Up to 1000 durable Endpoints
          - Maximum of 4 GB Message Spool
          - Maximum of 500K subscriptions
          - One Message VPN Scoped Admin account
        isHA: true
        evaluationLimits:
          maxVpns: 1
          credentialsPerVpn: 500
          maxConnections: 1000
          maxRestConnections: 1000
          maxSubscriptions: 500000
          maxTransactions: 5000
          maxTransactedSessions: 1000
          maxEndpoints: 1000
        enterpriseLimits:
          maxVpns: 1
          credentialsPerVpn: 990
          maxConnections: 1000
          maxRestConnections: 1000
          maxSubscriptions: 500000
          maxTransactions: 5000
          maxTransactedSessions: 1000
          maxEndpoints: 1000
      - planName: enterprise-large-ha
        poolName: enterprise-large-ha
        id: 8a905ceb-5f6d-4080-ae77-efa15ba19a4b
        description: A single Message VPN hosted on a Large Solace PubSub+ Message Broker. Consumes 3 Large-HA Solace PubSub+ Message Brokers to create an HA service instance.
        pointFormDescription:
          - A Message VPN on dedicated Solace Message Router in an HA Cluster
          - Up to 500 Service Instance Bindings
          - Up to 1000 durable Endpoints
          - Maximum of 20 GB Message Spool
          - Maximum of 500K subscriptions
          - One Message VPN Scoped Admin account
        isHA: true
        evaluationLimits:
          maxVpns: 1
          credentialsPerVpn: 500
          maxConnections: 1000
          maxRestConnections: 1000
          maxSubscriptions: 500000
          maxTransactions: 5000
          maxTransactedSessions: 1000
          maxEndpoints: 1000
        enterpriseLimits:
          maxVpns: 1
          credentialsPerVpn: 9990
          maxConnections: 10000
          maxRestConnections: 6000
          maxSubscriptions: 500000
          maxTransactions: 50000
          maxTransactedSessions: 10000
          maxEndpoints: 10000
    solace_pubsub_broker:
      app_manifest:
        buildpack: java_buildpack
        env:
          IS_ENTERPRISE_MODE: '((is_enterprise_mode))'
          JBP_CONFIG_CONTAINER_CERTIFICATE_TRUST_STORE: '{enabled: true}'
          SOLACE_LOAD_VERSION: ((solace_load_version))
          SOLACE_ROUTER_CLIENT_ID: ((solace_router_client_id))
          SOLACE_ROUTER_CLIENT_SECRET: ((solace_router_client_secret))
        memory: 1024M
        path: ((solace_service_broker_jar))
        health-check-http-endpoint: /health
        health-check-type: http
        timeout: 180
      enable_global_access_to_plans: ((enable_global_access_to_plans))
      password: ((service_broker_password))
      user: ((service_broker_user))
    space: ((solace_broker_cf_space))
    ssl:
      skip_cert_verify: true
    starting_port: ((starting_port))
    syslog_config:
      value: disabled
    tcp_routes_config:
      selected_option:
        tcp_route_enabled: not_allowed
      value: disabled
    tls_config:
      value: disabled
    vmr_admin_password: ((vmr_admin_password))
- name: enterprise-shared
  stemcell: default
  instances: 0
  vm_type: solace.medium
  azs:
  - z1
  - z2
  - z3
  networks:
  - name: default
  persistent_disk: 30720
  jobs:
  - name: docker
    release: docker
    consumes: {}
  - name: pubsub_common
    release: solace-pubsub
    consumes: {}
    provides:
      solace_pubsub_instance: { as: shared_list }
  - name: containers
    release: solace-pubsub
    consumes: {}
  - name: broker_agent
    release: solace-pubsub
    consumes: {}
  - name: route_registrar
    release: solace-pubsub
    consumes:
      nats_link:
        from: nats
        deployment: ((cf_deployment))
  properties:
    pubsub_config_job: broker_agent
    containers: &containers
    - dockerfile: |2-
                  FROM solace-app:latest

                  RUN \
                    echo '#!/bin/bash' > /sbin/dhclient && \
                    echo 'exit 0' >> /sbin/dhclient && \
                    echo '3a:40:d5:42:f4:86' > /usr/sw/.nodeIdentifyingMacAddr && \
                    chmod +x /sbin/dhclient
      env_file: &env_file /var/vcap/store/pubsub_config/docker_env
      image: solace-bosh
      name: pubsub
      net: host
      privileged: true
      shm_size: 2G
      uts: host
      volumes: &volumes
      - /var/vcap/store/containers/pubsub/volumes/jail:/usr/sw/jail
      - /var/vcap/store/containers/pubsub/volumes/var:/usr/sw/var
      - /var/vcap/store/containers/pubsub/volumes/internalSpool:/usr/sw/internalSpool
      - /var/vcap/store/containers/pubsub/volumes/adbBackup:/usr/sw/adb
      - /var/vcap/store/containers/pubsub/volumes/adb:/usr/sw/internalSpool/softAdb
      - /var/vcap/store/containers/pubsub/volumes/secrets:/run/secrets
    plan:
      limit:
        maxVpns: 5
        credentialsPerVpn: 100
        maxConnections: 200
        maxRestConnections: 200
        maxSubscriptions: 100000
        maxTransactions: 1000
        maxTransactedSessions: 200
        maxEndpoints: 200
    config:
      keys: &config_keys
        nodetype: message_routing
        username_admin_globalaccesslevel: admin
        username_admin_password: ((vmr_admin_password))
        username_mgmt_globalaccesslevel: admin
        username_mgmt_password: ((mgmt_password))
        service_ssh_port: &service_ssh_port 3022
        service_semp_port: 8080
        service_semp_tlsport: 943
        service_healthcheck_port: 9090
        system_scaling_maxconnectioncount: 1000
      settings: &config_settings
        pool_name: enterprise-shared
        broker_agent_port: 18080
        node_role: 'primary'
        starting_port: ((starting_port))
        edition: ((vmr_edition))
        vmr_debug_logs: disabled
        deployment_name: ((deployment_name))
        ldap_config:
          value: disabled
        management_access_auth_scheme:
          value: vmr_internal
        application_access_auth_scheme:
          value: vmr_internal
        tls_config:
          value: disabled
        syslog_config:
          value: disabled
        tcp_routes_config:
          selected_option:
            tcp_route_enabled: not_allowed
          value: disabled
        tcp_routes_enabled: disabled
      env: &config_env
        broker_hostname: solace-pubsub-broker.((app_domain))
        broker_password: ((service_broker_password))
        broker_user: ((service_broker_user))
        cf_api_host: api.((system_domain))
        cf_client_id: ((solace_router_client_id))
        cf_client_secret: ((solace_router_client_secret))
        cf_organization: ((solace_broker_cf_organization))
        cf_space: ((solace_broker_cf_space))
        system_domain: ((system_domain))
- name: enterprise-large
  stemcell: default
  instances: 0
  vm_type: solace.large
  azs:
  - z1
  - z2
  - z3
  networks:
  - name: default
  persistent_disk: 40960
  jobs:
  - name: docker
    release: docker
    consumes: {}
  - name: pubsub_common
    release: solace-pubsub
    consumes: {}
    provides:
      solace_pubsub_instance: { as: large_list }
  - name: containers
    release: solace-pubsub
    consumes: {}
  - name: broker_agent
    release: solace-pubsub
    consumes: {}
  - name: route_registrar
    release: solace-pubsub
    consumes:
      nats_link:
        from: nats
        deployment: ((cf_deployment))
  properties:
    pubsub_config_job: broker_agent
    containers: *containers
    plan:
      limit:
        maxVpns: 1
        credentialsPerVpn: 500
        maxConnections: 1000
        maxRestConnections: 1000
        maxSubscriptions: 500000
        maxTransactions: 5000
        maxTransactedSessions: 1000
        maxEndpoints: 1000
    config:
      keys:
        <<: *config_keys
        system_scaling_maxconnectioncount: 10000
      settings:
        <<: *config_settings
        pool_name: enterprise-large
      env:
        <<: *config_env
- name: enterprise-medium-ha
  stemcell: default
  instances: 0
  vm_type: solace.medium
  azs:
  - z1
  - z2
  - z3
  networks:
  - name: default
  persistent_disk: 20480
  jobs:
  - name: docker
    release: docker
    consumes: {}
  - name: pubsub_common
    release: solace-pubsub
    consumes: {}
    provides:
      solace_pubsub_instance: { as: medium_ha_list }
  - name: containers
    release: solace-pubsub
    consumes: {}
  - name: broker_agent
    release: solace-pubsub
    consumes: {}
  - name: route_registrar
    release: solace-pubsub
    consumes:
      nats_link:
        from: nats
        deployment: ((cf_deployment))
  - name: route_registrar_active
    release: solace-pubsub
    consumes:
      nats_link:
        from: nats
        deployment: ((cf_deployment))
  properties:
    pubsub_config_job: broker_agent
    containers: *containers
    plan:
      limit:
        maxVpns: 1
        credentialsPerVpn: 500
        maxConnections: 1000
        maxRestConnections: 1000
        maxSubscriptions: 500000
        maxTransactedSessions: 1000
        maxTransactions: 5000
        maxEndpoints: 1000
    config:
      keys:
        <<: *config_keys
        system_scaling_maxconnectioncount: 1000
      settings:
        <<: *config_settings
        pool_name: enterprise-medium-ha
      env:
        <<: *config_env
- name: enterprise-large-ha
  stemcell: default
  instances: 0
  vm_type: solace.large
  azs:
  - z1
  - z2
  - z3
  networks:
  - name: default
  persistent_disk: 40960
  jobs:
  - name: docker
    release: docker
    consumes: {}
  - name: pubsub_common
    release: solace-pubsub
    consumes: {}
    provides:
      solace_pubsub_instance: { as: large_ha_list }
  - name: containers
    release: solace-pubsub
    consumes: {}
  - name: broker_agent
    release: solace-pubsub
    consumes: {}
  - name: route_registrar
    release: solace-pubsub
    consumes:
      nats_link:
        from: nats
        deployment: ((cf_deployment))
  - name: route_registrar_active
    release: solace-pubsub
    consumes:
      nats_link:
        from: nats
        deployment: ((cf_deployment))
  properties:
    pubsub_config_job: broker_agent
    containers: *containers
    plan:
      limit:
        maxVpns: 1
        credentialsPerVpn: 500
        maxConnections: 1000
        maxRestConnections: 1000
        maxSubscriptions: 500000
        maxTransactedSessions: 1000
        maxTransactions: 5000
        maxEndpoints: 1000
    config:
      keys:
        <<: *config_keys
        system_scaling_maxconnectioncount: 10000
      settings:
        <<: *config_settings
        pool_name: enterprise-large-ha
      env:
        <<: *config_env
- name: standard-medium
  stemcell: default
  instances: 0
  vm_type: solace.medium
  azs:
  - z1
  - z2
  - z3
  networks:
  - name: default
  persistent_disk: 20480
  jobs:
  - name: docker
    release: docker
    consumes: {}
  - name: pubsub_common
    release: solace-pubsub
    consumes: {}
    provides:
      solace_pubsub_instance: { as: standard_medium_list }
  - name: containers
    release: solace-pubsub
    consumes: {}
  - name: broker_agent
    release: solace-pubsub
    consumes: {}
  - name: route_registrar
    release: solace-pubsub
    consumes:
      nats_link:
        from: nats
        deployment: ((cf_deployment))
  properties:
    pubsub_config_job: broker_agent
    containers: *containers
    plan:
      limit: *standard_medium_limits
    config:
      keys:
        <<: *config_keys
        system_scaling_maxconnectioncount: 1000
      settings:
        <<: *config_settings
        pool_name: standard-medium
      env:
        <<: *config_env
- name: standard-medium-ha
  stemcell: default
  instances: 0
  vm_type: solace.medium
  azs:
  - z1
  - z2
  - z3
  networks:
  - name: default
  persistent_disk: 20480
  jobs:
  - name: docker
    release: docker
    consumes: {}
  - name: pubsub_common
    release: solace-pubsub
    consumes: {}
    provides:
      solace_pubsub_instance: { as: standard_medium_ha_list }
  - name: containers
    release: solace-pubsub
    consumes: {}
  - name: broker_agent
    release: solace-pubsub
    consumes: {}
  - name: route_registrar
    release: solace-pubsub
    consumes:
      nats_link:
        from: nats
        deployment: ((cf_deployment))
  - name: route_registrar_active
    release: solace-pubsub
    consumes:
      nats_link:
        from: nats
        deployment: ((cf_deployment))
  properties:
    pubsub_config_job: broker_agent
    containers: *containers
    plan:
      limit: *standard_medium_ha_limits
    config:
      keys:
        <<: *config_keys
        system_scaling_maxconnectioncount: 1000
      settings:
        <<: *config_settings
        pool_name: standard-medium-ha
      env:
        <<: *config_env
- name: tests
  jobs:
  - name: tests
    release: solace-pubsub
    provides: {}
    consumes:
      solace_pubsub_shared: { from: shared_list }
      solace_pubsub_large: { from: large_list }
      solace_pubsub_medium_ha: { from: medium_ha_list }
      solace_pubsub_large_ha: { from: large_ha_list }
      solace_pubsub_standard_medium: { from: standard_medium_list }
      solace_pubsub_standard_medium_ha: { from: standard_medium_ha_list }
  instances: 1
  vm_type: minimal
  stemcell: default
  lifecycle: errand
  azs:
  - z1
  networks:
  - name: default
  properties:
    apply_open_security_group: true
    app_domains:
    - ((app_domain))
    application_access_auth_scheme:
      value: vmr_internal
    broker_hostname: solace-pubsub-broker.((app_domain))
    broker_password: ((service_broker_password))
    broker_user: ((service_broker_user))
    cf:
      admin_password: ((cf_admin_password))
      admin_user: admin
    domain: ((system_domain))
    ldap_config:
      value: disabled
    management_access_auth_scheme:
      value: vmr_internal
    org: ((solace_broker_cf_organization))
    security:
      password: ((service_broker_password))
      user: ((service_broker_user))
    solace_pubsub_broker:
      app_manifest:
        buildpack: java_buildpack
        env:
          IS_ENTERPRISE_MODE: '((is_enterprise_mode))'
          JBP_CONFIG_CONTAINER_CERTIFICATE_TRUST_STORE: '{enabled: true}'
          SOLACE_LOAD_VERSION: ((solace_load_version))
          SOLACE_ROUTER_CLIENT_ID: ((solace_router_client_id))
          SOLACE_ROUTER_CLIENT_SECRET: ((solace_router_client_secret))
        memory: 1024M
        path: ((solace_service_broker_jar))
        health-check-http-endpoint: /health
        health-check-type: http
        timeout: 180
      enable_global_access_to_plans: ((enable_global_access_to_plans))
      password: ((service_broker_password))
      user: ((service_broker_user))
    space: ((solace_broker_cf_space))
    ssl:
      skip_cert_verify: true
    starting_port: ((starting_port))
    syslog_config:
      value: disabled
    tcp_routes_config:
      selected_option:
        tcp_route_enabled: not_allowed
      value: disabled
    tls_config:
      value: disabled
    vmr_admin_password: ((vmr_admin_password))
- name: delete-all
  instances: 1
  vm_type: minimal
  stemcell: default
  lifecycle: errand
  azs:
  - z1
  networks:
  - name: default
  properties:
    app_domains:
    - ((app_domain))
    application_access_auth_scheme:
      value: vmr_internal
    cf:
      admin_password: ((cf_admin_password))
      admin_user: admin
    domain: ((system_domain))
    ldap_config:
      value: disabled
    management_access_auth_scheme:
      value: vmr_internal
    org: ((solace_broker_cf_organization))
    security:
      password: ((service_broker_password))
      user: ((service_broker_user))
    solace_pubsub_broker:
      app_manifest:
        buildpack: java_buildpack
        env:
          IS_ENTERPRISE_MODE: '((is_enterprise_mode))'
          JBP_CONFIG_CONTAINER_CERTIFICATE_TRUST_STORE: '{enabled: true}'
          SOLACE_LOAD_VERSION: ((solace_load_version))
          SOLACE_ROUTER_CLIENT_ID: ((solace_router_client_id))
          SOLACE_ROUTER_CLIENT_SECRET: ((solace_router_client_secret))
        memory: 1024M
        path: ((solace_service_broker_jar)) 
        health-check-http-endpoint: /health
        health-check-type: http
      enable_global_access_to_plans: ((enable_global_access_to_plans))
      password: ((service_broker_password))
      user: ((service_broker_user))
    space: ((solace_broker_cf_space))
    ssl:
      skip_cert_verify: true
    starting_port: ((starting_port))
    syslog_config:
      value: disabled
    tcp_routes_config:
      selected_option:
        tcp_route_enabled: not_allowed
      value: disabled
    tls_config:
      value: disabled
    vmr_admin_password: ((vmr_admin_password))
  jobs:
  - name: delete-all
    release: solace-pubsub-broker
    consumes:
      solace_pubsub_shared: { from: shared_list }
      solace_pubsub_large: { from: large_list }
      solace_pubsub_medium_ha: { from: medium_ha_list }
      solace_pubsub_large_ha: { from: large_ha_list }
      solace_pubsub_standard_medium: { from: standard_medium_list }
      solace_pubsub_standard_medium_ha: { from: standard_medium_ha_list }
      mysql: { from: mysql-proxy }
- name: management
  instances: 1
  networks:
  - name: default
  azs: [z1, z2]
  persistent_disk_type: 10GB
  update:
    serial: true
  vm_type: small
  stemcell: default
  jobs:
  - name: mysql
    release: cf-mysql
    properties:
      cf_mysql:
        mysql:
          admin_password: ((cf_mysql_mysql_admin_password))
          remote_admin_access: false
          innodb_buffer_pool_size: 128M # https://github.com/cloudfoundry/cf-mysql-deployment/blob/master/operations/bosh-lite.yml
          cluster_health:
            password: ((cf_mysql_mysql_cluster_health_password))
          galera_healthcheck:
            db_password: ((cf_mysql_mysql_galera_healthcheck_db_password))
            endpoint_password: ((cf_mysql_mysql_galera_healthcheck_endpoint_password))
          port: 13306
          seeded_databases:
          - name: solace_service_broker
            username: service_broker
            password: ((cf_mysql_mysql_seeded_databases_service_broker_password))
  - name: proxy
    release: cf-mysql
    properties:
      cf_mysql:
        proxy:
          api_password: ((cf_mysql_proxy_api_password))
    provides:
      proxy:
        as: mysql-proxy
- name: solace-od-service-adapter
  stemcell: default
  instances: 1
  vm_type: solace.medium
  azs:
  - z1
  - z2
  - z3
  networks:
  - name: default
  jobs:
  - name: service-adapter
    release: solace-service-adapter
    properties:
      solace_instance_group_name: SolacePubSub+
      cf_deployment: cf
  - name: register-broker
    release: on-demand-service-broker
    properties:
      broker_name: od_solace_pubsub
      broker_uri: https://od_solace_pubsub.((system_domain))
      disable_ssl_cert_verification: true
      cf:
        api_url: api.((system_domain))
        admin_username: admin
        admin_password: ((cf_admin_password))
  - name: deregister-broker
    release: on-demand-service-broker
    properties:
      broker_name: od_solace_pubsub
    jobs: []
  - name: broker
    provides:
      broker: { as: solace_pubsub_od_broker }
    release: on-demand-service-broker
    properties:
      disable_ssl_cert_verification: true
      expose_operational_errors: false
      startup_banner: true
      port: 8080
      username: ((service_broker_user))
      password: ((service_broker_password))
      shutdown_timeout_in_seconds: 10
      bosh:
        url: ((bosh_host))
        authentication:
          basic:
            username: admin
            password: ((bosh_admin_password))
        root_ca_cert: ((bosh_root_ca_cert))
        disable_ssl_cert_verification: ((bosh_disable_ssl_cert_verification))
      cf:
        disable_ssl_cert_verification: true
        url: https://api.((system_domain))
        authentication:
          url: https://uaa.((system_domain))
          user_credentials:
            username: admin
            password: ((cf_admin_password))
      service_deployment:
        releases:
        - name: solace-pubsub
          version: ((solace_pubsub_version))
          jobs: [ containers, route_registrar, route_registrar_active, pubsub_common, pubsub_config, broker_agent ]
        - name: docker
          version: ((docker_version))
          jobs: [ docker ]
        stemcell:
          os: ((bosh_stemcell))
          version: ((bosh_stemcell_version))
      service_catalog:
        id: 05e81eec-762e-415c-b840-a804fc526ac2
        service_name: solace-pubsub-od
        service_description: Service Description
        bindable: true
        plan_updatable: true
        metadata:
          displayName: OD Service Broker
        tags:
        - solace
        - pubsub
        - messaging
        global_properties:
          allocate_ahead: true
          persistence: true
        plans:
        - name: enterprise-shared
          plan_id: 6bc108f1-faaf-4782-8d7b-9120cb8b0d2e
          description: A Standalone Solace PubSub+ Software
          metadata:
            display_name: A standalone instance of Solace PubSub+ Software
            bullets: []
          quotas: &quotas
            service_instance_limit: 3
          instance_groups: &standalone_instance_groups
            - name: SolacePubSub+
              vm_type: default
              persistent_disk_type: 10GB
              instances: 1
              networks: [default]
              azs: [z1]
          update: &updates
            canaries: 1
            canary_watch_time: 30000-240000
            update_watch_time: 30000-600000
            max_in_flight: 1
            serial: true
          properties:
            cf_api_host: api.((system_domain))
            containers: *containers
            config:
              keys:
                <<: *config_keys
                system_scaling_maxconnectioncount: 1000
              settings:
                <<: *config_settings
                pool_name: enterprise-shared
              env:
                <<: *config_env
            plan:
              limit:
                maxVpns: 5
                credentialsPerVpn: 100
                maxConnections: 200
                maxRestConnections: 200
                maxSubscriptions: 100000
                maxTransactedSessions: 200
                maxTransactions: 1000
                maxEndpoints: 200
              resources:
                shm_size_message_routing: 2G
              allowed_overrides:
              - config.keys.*
              - config.settings.*
              - config.env.*
        - name: enterprise-large
          plan_id: da3f5706-b2af-11e8-96f8-529269fb1459
          description: A Standalone Solace PubSub+ Software
          metadata:
            display_name: A standalone instance of Solace PubSub+ Software
            bullets: []
          quotas: *quotas
          instance_groups: *standalone_instance_groups
          updates: *updates
          properties:
            cf_api_host: api.((system_domain))
            containers: *containers
            config:
              keys:
                <<: *config_keys
                system_scaling_maxconnectioncount: 10000
              settings:
                <<: *config_settings
                pool_name: enterprise-large
              env:
                <<: *config_env
            plan:
              limit:
                maxVpns: 1
                credentialsPerVpn: 500
                maxConnections: 1000
                maxRestConnections: 1000
                maxSubscriptions: 500000
                maxTransactions: 5000
                maxTransactedSessions: 1000
                maxEndpoints: 1000
              resources:
                shm_size_message_routing: 2G
              allowed_overrides:
              - config.keys.*
              - config.settings.*
              - config.env.*
        - name: enterprise-medium-ha
          plan_id: 8bc308f1-caaf-7782-837b-91871924712e
          description: A High Availability Deployment of Solace PubSub+ Software
          metadata:
            display_name: A High Availability Deployment of Solace PubSub+ Software
            bullets: []
          quotas: *quotas
          instance_groups: &ha_instance_groups
            - name: Primary
              vm_type: default
              persistent_disk_type: 10GB
              instances: 1
              networks: [default]
              azs: [z1]
            - name: Backup
              vm_type: default
              persistent_disk_type: 10GB
              instances: 1
              networks: [default]
              azs: [z2]
            - name: Monitor
              vm_type: minimal
              persistent_disk_type: 10GB
              instances: 1
              networks: [default]
              azs: [z3]
          update:  *updates
          properties:
            cf_api_host: api.((system_domain))
            containers: *containers
            plan:
              limit:
                maxVpns: 5
                credentialsPerVpn: 100
                maxConnections: 200
                maxRestConnections: 200
                maxSubscriptions: 100000
                maxTransactedSessions: 200
                maxTransactions: 1000
                maxEndpoints: 200
              resources:
                shm_size_primary: 2G
                shm_size_backup: 2G
                shm_size_monitor: 1G
              allowed_overrides:
              - config.keys.*
              - config.settings.*
              - config.env.*
            config:
              keys:
                <<: *config_keys
                system_scaling_maxconnectioncount: 1000
              settings:
                <<: *config_settings
                pool_name: enterprise-medium-ha
              env:
                <<: *config_env
        - name: enterprise-large-ha
          plan_id: 5abbd06c-b2b0-11e8-96f8-529269fb1459
          description: A High Availability Deployment of Solace PubSub+ Software
          metadata:
            display_name: A High Availability Deployment of Solace PubSub+ Software
            bullets: []
          quotas: *quotas
          instance_groups: *ha_instance_groups
          update:  *updates
          properties:
            cf_api_host: api.((system_domain))
            containers: *containers
            plan:
              limit:
                maxVpns: 1
                credentialsPerVpn: 500
                maxConnections: 1000
                maxRestConnections: 1000
                maxSubscriptions: 500000
                maxTransactions: 5000
                maxTransactedSessions: 1000
                maxEndpoints: 1000
              resources:
                shm_size_primary: 2G
                shm_size_backup: 2G
                shm_size_monitor: 1G
              allowed_overrides:
              - config.keys.*
              - config.settings.*
              - config.env.*
            config:
              keys:
                <<: *config_keys
                system_scaling_maxconnectioncount: 1000
              settings:
                <<: *config_settings
                pool_name: enterprise-large-ha
              env:
                <<: *config_env
        - name: standard-medium
          plan_id: 5fbb5c9a-b2b0-11e8-96f8-529269fb1459
          description: A Standalone Solace PubSub+ Software
          metadata:
            display_name: A standalone instance of Solace PubSub+ Software
            bullets: []
          quotas: *quotas
          instance_groups: *standalone_instance_groups
          update: *updates
          properties:
            cf_api_host: api.((system_domain))
            containers: *containers
            config:
              keys:
                <<: *config_keys
                system_scaling_maxconnectioncount: 1000
              settings:
                <<: *config_settings
                pool_name: standard_medium
              env:
                <<: *config_env
            plan:
              limit: *standard_medium_limits
              resources:
                shm_size_message_routing: 2G
              allowed_overrides:
              - config.keys.*
              - config.settings.*
              - config.env.*
        - name: standard-medium-ha
          plan_id: 850eedd6-b2b0-11e8-96f8-529269fb1459
          description: A High Availability Deployment of Solace PubSub+ Software
          metadata:
            display_name: A High Availability Deployment of Solace PubSub+ Software
            bullets: []
          quotas: *quotas
          instance_groups: *ha_instance_groups
          update:  *updates
          properties:
            cf_api_host: api.((system_domain))
            containers: *containers
            plan:
              limit: *standard_medium_ha_limits
              resources:
                shm_size_primary: 2G
                shm_size_backup: 2G
                shm_size_monitor: 1G
              allowed_overrides:
              - config.keys.*
              - config.settings.*
              - config.env.*
            config:
              keys:
                <<: *config_keys
                system_scaling_maxconnectioncount: 1000
              settings:
                pool_name: standard-medium-ha
                <<: *config_settings
              env:
                <<: *config_env
variables:
- name: mgmt_password
  type: password
- name: vmr_admin_password
  type: password
- name: service_broker_user
  type: password
- name: service_broker_password
  type: password
- name: solace_router_client_secret
  type: password
- name: example_ca
  type: certificate
  options: {is_ca: true, common_name: example-ca}
- name: solace_vmr_cert
  type: certificate
  options: {ca: example_ca, common_name: solace-pubsub-cert, extended_key_usage: [client_auth, server_auth]}
- name: cf_mysql_mysql_admin_password
  type: password
- name: cf_mysql_mysql_cluster_health_password
  type: password
- name: cf_mysql_mysql_galera_healthcheck_endpoint_password
  type: password
- name: cf_mysql_mysql_galera_healthcheck_db_password
  type: password
- name: cf_mysql_mysql_seeded_databases_service_broker_password
  type: password
- name: cf_mysql_proxy_api_password
  type: password
- name: bosh_admin_password
  type: password
- name: bosh_root_ca_cert
  type: certificate
  options: {ca: example_ca, common_name: bosh-root-ca-cert}
